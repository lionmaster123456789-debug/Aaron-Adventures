<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>V5 Aaron Adventures - Hybrid Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; color: #fff; }
        canvas { display: block; }
        #ui { position: absolute; top: 20px; left: 20px; z-index: 10; pointer-events: none; }
        #menu { position: absolute; inset: 0; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; text-align: center; }
        .skin-container { display: flex; gap: 15px; margin: 25px 0; }
        .skin-btn { width: 50px; height: 50px; border: 2px solid #555; cursor: pointer; border-radius: 12px; transition: 0.3s; }
        .skin-btn.locked { opacity: 0.2; filter: grayscale(1); cursor: not-allowed; }
        .skin-btn.active { border-color: #2ecc71; transform: scale(1.2); box-shadow: 0 0 15px #2ecc71; }
        button#startBtn { background: #2ecc71; color: white; border: none; padding: 15px 40px; font-size: 22px; border-radius: 30px; cursor: pointer; font-weight: bold; }
        h1 { font-size: 50px; letter-spacing: 5px; color: #eee; margin: 0; }
    </style>
</head>
<body>

<div id="ui">
    <div style="font-size: 28px; font-weight: bold;">LEVEL <span id="lvlDisplay">1</span></div>
    <div id="biomeDisplay" style="color: #888; text-transform: uppercase; letter-spacing: 2px;">Vantablack</div>
</div>

<div id="menu">
    <h1>AARON ADVENTURES</h1>
    <p>Wähle deinen Skin (Freigeschaltet alle 10 Level):</p>
    <div id="skinSelect" class="skin-container"></div>
    <button id="startBtn" onclick="startGame()">START MISSION</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let width, height, cameraX = 0, currentLevel = 1;
let gameState = 'menu';
let playerSkin = 0;

// Konfiguration
const SKINS = [
    { name: "Shadow", color: "#1a1a1a", eye: "#ff0000" },
    { name: "Hunter", color: "#2ecc71", eye: "#fff" },
    { name: "Ice Walker", color: "#00d2d3", eye: "#2c3e50" },
    { name: "Magma", color: "#e67e22", eye: "#ff0" },
    { name: "Cyber", color: "#9b59b6", eye: "#0ff" }
];

const BIOMES = [
    { name: "Vantablack", bg: "#050505", ground: "#111", decor: "particles" },
    { name: "Dschungel", bg: "#0a210f", ground: "#1b4d2e", decor: "waterfall" },
    { name: "Frost", bg: "#1e272e", ground: "#dff9fb", decor: "snow" },
    { name: "Lava", bg: "#1a0505", ground: "#c0392b", decor: "bubbles" },
    { name: "Cyber", bg: "#0f0c29", ground: "#24243e", decor: "grid" }
];

const player = { x: 100, y: 300, w: 45, h: 45, velX: 0, velY: 0, speed: 7, jump: -17, grounded: false };
let platforms = [], hazards = [], projectiles = [], decorations = [];

function resize() { 
    width = canvas.width = window.innerWidth; 
    height = canvas.height = window.innerHeight; 
}
window.onresize = resize;
resize();

function initLevel(lvl) {
    platforms = []; hazards = []; projectiles = []; decorations = [];
    player.x = 150; player.y = 300; player.velX = 0; player.velY = 0;
    cameraX = 0;
    
    const bIndex = Math.floor((lvl-1)/10) % BIOMES.length;
    const biome = BIOMES[bIndex];
    document.getElementById('lvlDisplay').innerText = lvl;
    document.getElementById('biomeDisplay').innerText = biome.name;

    // Generiere Hintergrund-Objekte
    for(let i=0; i<30; i++) {
        decorations.push({ x: Math.random()*5000, y: Math.random()*height, s: Math.random()*3 + 1 });
    }

    let lastX = 0, lastY = 500;
    platforms.push({ x: 0, y: 550, w: 400, h: 100, type: 'normal' });

    for(let i=0; i<15 + lvl; i++) {
        let pW = 160 + Math.random()*120;
        let pX = lastX + 130 + Math.random()*110;
        let pY = lastY + (Math.random()*180 - 90);
        pY = Math.max(200, Math.min(height-150, pY));

        let type = (i > 3 && Math.random() > 0.8) ? 'moving' : 'normal';
        platforms.push({ x: pX, y: pY, w: pW, h: 35, type: type, oy: pY, off: Math.random()*10 });

        if(Math.random() > 0.6) {
            hazards.push({ x: pX + 50, y: pY - 45, w: 40, h: 40, type: Math.random() > 0.5 ? 'drone' : 'cannon', t: 0 });
        }
        lastX = pX; lastY = pY;
    }
    platforms.push({ x: lastX + 300, y: lastY - 50, w: 100, h: 400, type: 'goal' });
    updateSkinButtons();
}

function update() {
    if(gameState !== 'playing') return;

    if(keys['ArrowLeft']) player.velX = -player.speed;
    else if(keys['ArrowRight']) player.velX = player.speed;
    else player.velX *= 0.8;

    player.velY += 0.85;
    player.x += player.velX;
    player.y += player.velY;
    cameraX += (player.x - cameraX - width/3) * 0.1;

    player.grounded = false;
    platforms.forEach(p => {
        if(p.type === 'moving') p.y = p.oy + Math.sin(Date.now()/600 + p.off) * 60;
        if(player.x + player.w > p.x && player.x < p.x + p.w && player.y + player.h > p.y && player.y + player.h < p.y + p.h + 25 && player.velY >= 0) {
            if(p.type === 'goal') { currentLevel++; initLevel(currentLevel); return; }
            player.y = p.y - player.h; player.velY = 0; player.grounded = true;
        }
    });

    hazards.forEach(h => {
        if(h.type === 'cannon') {
            if(++h.t % 120 === 0) projectiles.push({ x: h.x, y: h.y + 15, vx: -6 });
        }
        if(Math.abs(player.x - h.x) < 35 && Math.abs(player.y - h.y) < 35) initLevel(currentLevel);
    });

    projectiles.forEach((p, i) => {
        p.x += p.vx;
        if(Math.abs(player.x - p.x) < 25 && Math.abs(player.y - p.y) < 25) initLevel(currentLevel);
    });

    if(player.y > height + 100) initLevel(currentLevel);
}

function draw() {
    const biome = BIOMES[Math.floor((currentLevel-1)/10) % BIOMES.length];
    ctx.fillStyle = biome.bg;
    ctx.fillRect(0, 0, width, height);

    // Deko-Objekte
    ctx.fillStyle = "rgba(255,255,255,0.1)";
    decorations.forEach(d => {
        let dx = (d.x - cameraX * 0.3) % 2000;
        if(biome.decor === "snow") {
            ctx.beginPath(); ctx.arc(dx, (d.y + Date.now()/20)%height, d.s, 0, Math.PI*2); ctx.fill();
        } else if(biome.decor === "waterfall") {
            ctx.fillStyle = "rgba(52, 152, 219, 0.2)";
            ctx.fillRect(dx, 0, 40, height);
        } else {
            ctx.fillRect(dx, d.y, d.s*2, d.s*2);
        }
    });

    // Plattformen
    platforms.forEach(p => {
        ctx.fillStyle = p.type === 'goal' ? '#2ecc71' : biome.ground;
        if(p.type === 'goal') ctx.shadowBlur = 20, ctx.shadowColor = '#2ecc71';
        ctx.beginPath(); ctx.roundRect(p.x - cameraX, p.y, p.w, p.h, 5); ctx.fill();
        ctx.shadowBlur = 0;
    });

    // Gegner (Verbessert)
    hazards.forEach(h => {
        ctx.fillStyle = "#333";
        ctx.beginPath(); ctx.roundRect(h.x - cameraX, h.y, 40, 40, 8); ctx.fill();
        ctx.fillStyle = (Date.now() % 400 > 200) ? "#ff0000" : "#600"; // Pulsierender Kern
        ctx.beginPath(); ctx.arc(h.x - cameraX + 20, h.y + 20, 8, 0, Math.PI*2); ctx.fill();
    });

    // Projektile
    ctx.fillStyle = "#f1c40f";
    projectiles.forEach(p => { ctx.beginPath(); ctx.arc(p.x - cameraX, p.y, 8, 0, Math.PI*2); ctx.fill(); });

    // Aaron (Abgerundet & Seriös)
    const skin = SKINS[playerSkin];
    ctx.save();
    ctx.translate(player.x - cameraX + 22.5, player.y + 22.5);
    ctx.fillStyle = skin.color;
    ctx.beginPath(); ctx.roundRect(-22.5, -22.5, 45, 45, 12); ctx.fill();
    ctx.strokeStyle = "rgba(255,255,255,0.2)"; ctx.stroke();
    // Augen
    ctx.fillStyle = skin.eye;
    ctx.fillRect(-12, -12, 10, 5); ctx.fillRect(4, -12, 10, 5);
    ctx.restore();

    update();
    requestAnimationFrame(draw);
}

function updateSkinButtons() {
    const container = document.getElementById('skinSelect');
    container.innerHTML = '';
    const unlockedCount = Math.floor((currentLevel-1)/10) + 1;
    SKINS.forEach((s, i) => {
        const div = document.createElement('div');
        div.className = `skin-btn ${i >= unlockedCount ? 'locked' : ''} ${i === playerSkin ? 'active' : ''}`;
        div.style.background = s.color;
        if(i < unlockedCount) div.onclick = () => { playerSkin = i; updateSkinButtons(); };
        container.appendChild(div);
    });
}

const keys = {};
window.onkeydown = (e) => {
    keys[e.code] = true;
    if((e.code === 'ArrowUp' || e.code === 'Space') && player.grounded) player.velY = player.jump;
};
window.onkeyup = (e) => keys[e.code] = false;

function startGame() {
    document.getElementById('menu').style.display = 'none';
    if(gameState === 'menu') {
        gameState = 'playing';
        initLevel(currentLevel);
        draw();
    }
}
updateSkinButtons();
</script>
</body>
</html>
