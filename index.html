<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title> V3 Aaron Adventures - Serious Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background: #050505; font-family: 'Courier New', Courier, monospace; color: #fff; }
        canvas { display: block; filter: contrast(1.1) brightness(0.9); }
        #overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(0,0,0,0.8); z-index: 10; }
        #skinMenu { display: none; flex-direction: row; gap: 20px; margin-top: 20px; }
        .skin-card { border: 2px solid #444; padding: 10px; cursor: pointer; text-align: center; border-radius: 8px; transition: 0.3s; }
        .skin-card.locked { opacity: 0.3; cursor: not-allowed; }
        .skin-card.selected { border-color: #00ff00; background: rgba(0,255,0,0.1); }
        h1 { font-size: 60px; text-transform: uppercase; letter-spacing: 10px; margin: 0; color: #e74c3c; text-shadow: 0 0 20px #ff0000; }
        .stat-bar { position: absolute; top: 20px; left: 20px; font-size: 20px; z-index: 5; pointer-events: none; }
        .btn { padding: 15px 40px; font-size: 24px; background: #e74c3c; color: white; border: none; cursor: pointer; margin-top: 20px; }
        .btn:hover { background: #c0392b; box-shadow: 0 0 15px #e74c3c; }
    </style>
</head>
<body>

<div class="stat-bar">
    LEVEL: <span id="lvlDisplay">1</span> | SKIN: <span id="skinDisplay">Veteran</span>
</div>

<div id="overlay">
    <h1>AARON ADVENTURES</h1>
    <p style="color: #888;">Nichts für schwache Nerven.</p>
    
    <div id="skinMenu"></div>
    
    <button class="btn" onclick="startGame()">MISSION STARTEN</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
/**
 * AARON ADVENTURES - SERIOUS & DETAILED
 */

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let gameState = 'menu';
let currentLevel = 1;
let unlockedSkins = 1;
let selectedSkin = 0;
let cameraX = 0;

// Physik-Konstanten für präzisen Jump
const GRAVITY = 0.8;
const JUMP_FORCE = -16;
const SPEED = 7;
const COYOTE_TIME = 5; // Erlaubt Springen kurz nach Kante

const skins = [
    { name: "Veteran", color: "#2c3e50", eye: "#e74c3c", detail: "Scars" },
    { name: "Cyber-Unit", color: "#00d2d3", eye: "#fff", detail: "Circuits" },
    { name: "Wraith", color: "#1e272e", eye: "#808e9b", detail: "Shadow" },
    { name: "Lava-King", color: "#c0392b", eye: "#f1c40f", detail: "Cracks" },
    { name: "Ghost", color: "#f1f2f6", eye: "#2f3542", detail: "Vanish" }
];

const player = {
    x: 100, y: 300, w: 45, h: 45,
    velX: 0, velY: 0,
    grounded: false,
    coyoteTimer: 0,
    jumpBuffer: 0,
    facing: 1
};

let platforms = [];
let hazards = [];
let animFrame = 0;

function initLevel(lvl) {
    platforms = [];
    hazards = [];
    player.x = 100;
    player.y = 300;
    player.velX = 0;
    player.velY = 0;
    cameraX = 0;
    
    document.getElementById('lvlDisplay').innerText = lvl;
    unlockedSkins = Math.min(5, Math.floor((lvl - 1) / 5) + 1);
    updateSkinMenu();

    let lastX = 0;
    let lastY = 500;

    // Generiere Level-Umgebung
    for(let i = 0; i < 20 + lvl; i++) {
        let pW = 150 + Math.random() * 100;
        let pX = lastX + 100 + Math.random() * 130;
        let pY = lastY + (Math.random() * 160 - 80);
        
        // Boundaries
        pY = Math.max(200, Math.min(canvas.height - 100, pY));

        let type = 'normal';
        if(Math.random() > 0.8) type = 'ice';
        if(Math.random() > 0.85) type = 'moving';
        if(Math.random() > 0.92) type = 'crumbling';

        platforms.push({ x: pX, y: pY, w: pW, h: 35, type: type, state: 1, offset: Math.random() * 10 });

        // Erhöhte Hindernisdichte je nach Level
        let hazardCount = Math.floor(lvl / 3) + 1;
        for(let j = 0; j < hazardCount; j++) {
            if(Math.random() > 0.6) {
                let hType = 'spike';
                const r = Math.random();
                if(r > 0.8) hType = 'saw';
                else if(r > 0.7) hType = 'laser';
                else if(r > 0.6) hType = 'turret';

                hazards.push({
                    x: pX + (Math.random() * (pW-40)),
                    y: pY - 30,
                    type: hType,
                    angle: 0,
                    timer: Math.random() * 100
                });
            }
        }
        lastX = pX + pW;
        lastY = pY;
    }
    platforms.push({ x: lastX + 150, y: lastY - 50, w: 200, h: 600, type: 'goal' });
}

function drawPlayer() {
    const skin = skins[selectedSkin];
    const px = player.x - cameraX;
    const py = player.y;

    ctx.save();
    // Aaron - Seriöser Kopf
    ctx.translate(px + 22, py + 22);
    
    // Kopf-Form (Maskuliner/Eckiger)
    ctx.fillStyle = skin.color;
    ctx.shadowBlur = 15;
    ctx.shadowColor = skin.eye;
    ctx.beginPath();
    ctx.roundRect(-22, -22, 44, 44, 8);
    ctx.fill();
    ctx.strokeStyle = "#000";
    ctx.lineWidth = 2;
    ctx.stroke();

    // Augen (Böse/Konzentriert)
    ctx.fillStyle = skin.eye;
    // Linkes Auge mit Narbe
    ctx.fillRect(-14, -12, 12, 4);
    if(skin.name === "Veteran") {
        ctx.strokeStyle = "#c0392b";
        ctx.beginPath(); ctx.moveTo(-10, -18); ctx.lineTo(-6, -2); ctx.stroke();
    }
    // Rechtes Auge
    ctx.fillRect(4, -12, 12, 4);

    // Mund (Ernste Linie)
    ctx.strokeStyle = "#000";
    ctx.beginPath();
    ctx.moveTo(-10, 15);
    ctx.lineTo(10, 15);
    ctx.stroke();

    ctx.restore();
    ctx.shadowBlur = 0;
}

function update() {
    if(gameState !== 'playing') return;

    // Input Handling
    if(keys['ArrowLeft']) player.velX = -SPEED;
    else if(keys['ArrowRight']) player.velX = SPEED;
    else player.velX *= 0.8;

    // Jump Logic
    if(player.jumpBuffer > 0 && player.coyoteTimer > 0) {
        player.velY = JUMP_FORCE;
        player.jumpBuffer = 0;
        player.coyoteTimer = 0;
    }
    if(player.jumpBuffer > 0) player.jumpBuffer--;

    player.velY += GRAVITY;
    player.x += player.velX;
    player.y += player.velY;

    if(player.grounded) player.coyoteTimer = COYOTE_TIME;
    else player.coyoteTimer--;

    player.grounded = false;
    cameraX += (player.x - cameraX - 300) * 0.1;

    // Kollision
    platforms.forEach(p => {
        if(p.type === 'moving') p.y += Math.sin(Date.now()/500 + p.offset) * 2;
        
        if(player.x + player.w > p.x && player.x < p.x + p.w &&
           player.y + player.h > p.y && player.y + player.h < p.y + p.h + 20 && player.velY >= 0) {
            
            if(p.type === 'goal') {
                currentLevel++;
                initLevel(currentLevel);
                gameState = 'menu';
                document.getElementById('overlay').style.display = 'flex';
                return;
            }
            player.y = p.y - player.h;
            player.velY = 0;
            player.grounded = true;
            if(p.type === 'crumbling') p.state -= 0.02;
        }
    });

    // Gefahren
    hazards.forEach(h => {
        if(h.type === 'saw') h.angle += 0.2;
        let dist = Math.hypot((player.x+22) - (h.x+15), (player.y+22) - (h.y+15));
        if(dist < 35) die();
    });

    if(player.y > canvas.height) die();
}

function die() {
    initLevel(currentLevel);
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Background Details
    ctx.fillStyle = "#111";
    for(let i=0; i<5; i++) ctx.fillRect((i*500 - cameraX*0.2) % canvas.width, 0, 2, canvas.height);

    // Platforms
    platforms.forEach(p => {
        if(p.state <= 0) return;
        let grad = ctx.createLinearGradient(p.x - cameraX, p.y, p.x - cameraX, p.y + p.h);
        
        if(p.type === 'normal') { grad.addColorStop(0, '#444'); grad.addColorStop(1, '#222'); }
        if(p.type === 'ice') { grad.addColorStop(0, '#00d2d3'); grad.addColorStop(1, '#54a0ff'); ctx.shadowBlur = 10; ctx.shadowColor = "#00d2d3"; }
        if(p.type === 'moving') { grad.addColorStop(0, '#f1c40f'); grad.addColorStop(1, '#f39c12'); }
        if(p.type === 'crumbling') { ctx.globalAlpha = p.state; grad.addColorStop(0, '#e74c3c'); grad.addColorStop(1, '#000'); }

        ctx.fillStyle = grad;
        ctx.fillRect(p.x - cameraX, p.y, p.w, p.h);
        ctx.globalAlpha = 1.0;
        ctx.shadowBlur = 0;
    });

    // Hazards
    hazards.forEach(h => {
        ctx.save();
        ctx.translate(h.x - cameraX + 15, h.y + 15);
        if(h.type === 'saw') {
            ctx.rotate(h.angle);
            ctx.fillStyle = "#95a5a6";
            for(let i=0; i<8; i++) {
                ctx.rotate(Math.PI/4);
                ctx.fillRect(0, -20, 5, 40);
            }
        } else if(h.type === 'spike') {
            ctx.fillStyle = "#7f8c8d";
            ctx.beginPath(); ctx.moveTo(-15, 15); ctx.lineTo(0, -15); ctx.lineTo(15, 15); ctx.fill();
        }
        ctx.restore();
    });

    drawPlayer();
    update();
    requestAnimationFrame(draw);
}

function updateSkinMenu() {
    const menu = document.getElementById('skinMenu');
    menu.innerHTML = '';
    menu.style.display = 'flex';
    skins.forEach((s, i) => {
        const card = document.createElement('div');
        card.className = `skin-card ${i >= unlockedSkins ? 'locked' : ''} ${i === selectedSkin ? 'selected' : ''}`;
        card.innerHTML = `<div style="width:40px;height:40px;background:${s.color};margin:auto"></div><br>${s.name}`;
        if(i < unlockedSkins) card.onclick = () => { selectedSkin = i; updateSkinMenu(); };
        menu.appendChild(card);
    });
}

const keys = {};
window.onkeydown = (e) => {
    keys[e.code] = true;
    if(e.code === 'ArrowUp' || e.code === 'Space') player.jumpBuffer = 6;
};
window.onkeyup = (e) => keys[e.code] = false;

function startGame() {
    document.getElementById('overlay').style.display = 'none';
    if(gameState === 'menu') {
        gameState = 'playing';
        initLevel(currentLevel);
        draw();
    }
}

window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
updateSkinMenu();
</script>
</body>
</html>
