<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Aaron Adventures - Head Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        canvas { display: block; }
        #ui { position: absolute; top: 20px; left: 20px; color: white; text-shadow: 2px 2px #000; pointer-events: none; }
        #menu { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; text-align: center; background: rgba(0,0,0,0.85); padding: 30px; border-radius: 20px; border: 3px solid #3498db; }
        button { padding: 12px 30px; cursor: pointer; font-size: 20px; background: #3498db; color: white; border: none; border-radius: 5px; transition: 0.3s; }
        button:hover { background: #2980b9; transform: scale(1.1); }
    </style>
</head>
<body>

<div id="ui">
    <div style="font-size: 28px;">Level: <span id="lvlDisplay">1</span></div>
    <div style="font-size: 18px; color: #bdc3c7;">Skin: <span id="skinDisplay">Aaron-Kopf</span></div>
</div>

<div id="menu">
    <h1 style="font-size: 48px; margin-bottom: 10px;">AARON ADVENTURES</h1>
    <p>Steuerung: Pfeiltasten | Aaron ist jetzt ein mutiger schwebender Kopf!</p>
    <button onclick="startGame()">JETZT STARTEN</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
/**
 * AARON ADVENTURES - HEAD EDITION
 * Fokus: Optimierte Sprung-Physik & Head-Only Character
 */

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let gameState = 'menu';
let currentLevel = 1;
let cameraX = 0;

const player = {
    x: 100, y: 300,
    width: 45, height: 45, // Quadratischer für den Kopf
    velX: 0, velY: 0,
    speed: 6, jumpForce: -16,
    grounded: false,
    skinIndex: 0,
    eyeWink: 0
};

const BIOMES = [
    { name: "Grüne Wiesen", bg: "#1e3799", ground: "#78e08f" },
    { name: "Neon City", bg: "#2c3e50", ground: "#00d2d3" },
    { name: "Eiswelt", bg: "#dff9fb", ground: "#7ed6df" },
    { name: "Magma Kammer", bg: "#3e0000", ground: "#eb4d4b" }
];

const skins = [
    { name: "Basis Aaron", primary: "#3498db", secondary: "#2980b9" },
    { name: "Wald Geist", primary: "#2ecc71", secondary: "#27ae60" },
    { name: "Eis-Prinz", primary: "#ffffff", secondary: "#bdc3c7" },
    { name: "Inferno", primary: "#e67e22", secondary: "#d35400" }
];

let platforms = [];
let hazards = [];

function initLevel(num) {
    platforms = [];
    hazards = [];
    player.x = 100;
    player.y = 300;
    player.velX = 0;
    player.velY = 0;
    cameraX = 0;

    player.skinIndex = Math.floor((num - 1) / 10) % skins.length;
    document.getElementById('skinDisplay').innerText = skins[player.skinIndex].name;
    document.getElementById('lvlDisplay').innerText = num;

    // Start-Plattform
    platforms.push({ x: 0, y: 500, w: 300, h: 50, type: 'normal' });

    let lastX = 300;
    let lastY = 500;

    // Verbessertes Platform-Spawning (Erreichbarkeit garantiert)
    for(let i = 0; i < 25 + num; i++) {
        // Max Sprungweite ca. 250px, Max Sprunghöhe ca. 120px
        let pWidth = 120 + Math.random() * 100;
        let pX = lastX + 60 + Math.random() * 140; // Max Distanz kontrolliert
        
        // Y-Abstand kontrolliert (zwischen -100 und +100 relativ zur letzten Plattform)
        let pY = lastY + (Math.random() * 200 - 100);
        
        // Grenzen einhalten
        if(pY < 150) pY = 200;
        if(pY > canvas.height - 100) pY = canvas.height - 150;

        let type = 'normal';
        const rand = Math.random();
        if(rand > 0.85) type = 'moving';
        else if(rand > 0.75) type = 'ice';

        platforms.push({ x: pX, y: pY, w: pWidth, h: 30, type: type, originalY: pY, offset: Math.random() * 5 });

        // Hindernisse
        if(Math.random() > 0.7) {
            hazards.push({ x: pX + 40, y: pY - 30, w: 25, h: 25, type: 'enemy' });
        }

        lastX = pX + pWidth;
        lastY = pY;
    }

    platforms.push({ x: lastX + 100, y: lastY, w: 150, h: 400, type: 'goal' });
}

function drawPlayer() {
    const skin = skins[player.skinIndex];
    const centerX = player.x - cameraX + player.width / 2;
    const centerY = player.y + player.height / 2;

    ctx.save();
    ctx.translate(centerX, centerY);
    
    // Kopf-Körper
    ctx.fillStyle = skin.primary;
    ctx.strokeStyle = skin.secondary;
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.arc(0, 0, 22, 0, Math.PI * 2);
    ctx.fill();
    ctx.stroke();

    // Augen
    ctx.fillStyle = "white";
    ctx.beginPath();
    ctx.ellipse(-8, -5, 6, 8, 0, 0, Math.PI * 2);
    ctx.ellipse(8, -5, 6, 8, 0, 0, Math.PI * 2);
    ctx.fill();

    // Pupillen (folgen der Bewegung)
    ctx.fillStyle = "black";
    let lookX = (player.velX * 0.5);
    ctx.beginPath();
    ctx.arc(-8 + lookX, -5, 3, 0, Math.PI * 2);
    ctx.arc(8 + lookX, -5, 3, 0, Math.PI * 2);
    ctx.fill();

    // Mund (Lächeln)
    ctx.strokeStyle = "black";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(0, 5, 8, 0.2, Math.PI - 0.2, false);
    ctx.stroke();

    ctx.restore();
}

function update() {
    if(gameState !== 'playing') return;

    player.velY += 0.7; // Gravity
    player.x += player.velX;
    player.y += player.velY;
    player.grounded = false;

    cameraX = player.x - 250;

    platforms.forEach(p => {
        if(p.type === 'moving') p.y = p.originalY + Math.sin(Date.now() / 600 + p.offset) * 40;

        if (player.x < p.x + p.w && player.x + player.width > p.x &&
            player.y + player.height > p.y && player.y + player.height < p.y + p.h + 20) {
            
            if(player.velY > 0) {
                if(p.type === 'goal') {
                    currentLevel++;
                    initLevel(currentLevel);
                } else {
                    player.y = p.y - player.height;
                    player.velY = 0;
                    player.grounded = true;
                }
            }
        }
    });

    // Tod durch Herunterfallen
    if(player.y > canvas.height + 100) initLevel(currentLevel);

    // Hazard Kollision
    hazards.forEach(h => {
        let dx = (player.x + player.width/2) - (h.x + h.w/2);
        let dy = (player.y + player.height/2) - (h.y + h.h/2);
        if(Math.sqrt(dx*dx + dy*dy) < 30) initLevel(currentLevel);
    });
}

function draw() {
    const biome = BIOMES[Math.floor((currentLevel-1)/10) % BIOMES.length];
    ctx.fillStyle = biome.bg;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    platforms.forEach(p => {
        ctx.fillStyle = p.type === 'goal' ? '#f1c40f' : (p.type === 'ice' ? '#a29bfe' : biome.ground);
        ctx.fillRect(p.x - cameraX, p.y, p.w, p.h);
    });

    hazards.forEach(h => {
        ctx.fillStyle = '#e74c3c';
        ctx.beginPath();
        ctx.arc(h.x - cameraX + 12, h.y + 12, 12, 0, Math.PI * 2);
        ctx.fill();
    });

    drawPlayer();
    update();
    requestAnimationFrame(draw);
}

const keys = {};
window.onkeydown = (e) => {
    keys[e.code] = true;
    if((e.code === 'ArrowUp' || e.code === 'Space') && player.grounded) player.velY = player.jumpForce;
};
window.onkeyup = (e) => keys[e.code] = false;

function gameLoop() {
    if(keys['ArrowLeft']) player.velX = -player.speed;
    else if(keys['ArrowRight']) player.velX = player.speed;
    else player.velX *= 0.8;
}

function startGame() {
    document.getElementById('menu').style.display = 'none';
    gameState = 'playing';
    initLevel(1);
    setInterval(gameLoop, 10);
    draw();
}

window.onresize = () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
};
</script>
</body>
</html>
