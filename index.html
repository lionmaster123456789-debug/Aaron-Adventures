<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>AARON ADVENTURES: NATURE VANGUARD</title>
    <style>
        @import url('https://fonts.googleapis.com');
        :root { --moss: #4a6741; --stone: #7f8c8d; --sky: #2c3e50; --gold: #d4af37; }
        body, html { margin: 0; padding: 0; overflow: hidden; background: #000; font-family: 'Raleway', sans-serif; }
        canvas { display: block; filter: sepia(0.2) contrast(1.1) saturate(0.9); }
        
        /* REALISTIC HUD */
        #hud { position: absolute; top: 40px; left: 40px; z-index: 100; pointer-events: none; }
        .stat-card { background: rgba(20, 20, 20, 0.8); border: 1px solid var(--gold); padding: 25px; backdrop-filter: blur(10px); color: #ddd; box-shadow: 10px 10px 30px rgba(0,0,0,0.5); }
        .lvl-num { font-family: 'Cinzel', serif; font-size: 50px; color: var(--gold); line-height: 1; }
        
        /* OVERLAY MENU */
        #menu { position: absolute; inset: 0; background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://images.unsplash.com'); background-size: cover; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .title { font-family: 'Cinzel', serif; font-size: 80px; color: #fff; text-shadow: 0 0 30px rgba(0,0,0,1); margin: 0; letter-spacing: 10px; }
        
        .vault { display: flex; gap: 20px; margin: 40px 0; }
        .slot { width: 120px; height: 140px; background: rgba(255,255,255,0.05); border: 1px solid #444; cursor: pointer; transition: 0.4s; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 5px; }
        .slot.unlocked:hover { border-color: var(--gold); box-shadow: 0 0 30px var(--gold); transform: translateY(-5px); }
        .slot.selected { border-color: var(--gold); background: rgba(212, 175, 55, 0.1); }
        .slot.locked { opacity: 0.2; cursor: not-allowed; }

        .btn { background: var(--gold); color: #000; border: none; padding: 20px 80px; font-size: 24px; font-weight: 900; cursor: pointer; font-family: 'Cinzel', serif; transition: 0.3s; clip-path: polygon(10% 0, 100% 0, 90% 100%, 0% 100%); }
        .btn:hover { transform: scale(1.05); background: #fff; }
    </style>
</head>
<body>

<div id="hud">
    <div class="stat-card">
        <div style="font-size: 10px; letter-spacing: 3px; margin-bottom: 5px;">ANCIENT_SECTOR_REACHED</div>
        <div class="lvl-num">LVL <span id="lvlDisplay">01</span></div>
        <div id="biomeInfo" style="font-size: 14px; margin-top: 5px; color: var(--gold);">VALLEY OF ORIGIN</div>
    </div>
</div>

<div id="menu">
    <h1 class="title">AARON</h1>
    <div style="color: var(--gold); letter-spacing: 12px; font-weight: 300; margin-top: -10px;">ADVENTURES: NATURE</div>
    <div class="vault" id="vault"></div>
    <button class="btn" onclick="VanguardCore.launch()">START MISSION</button>
</div>

<canvas id="mainCanvas"></canvas>

<script>
/**
 * AARON ADVENTURES: NATURE VANGUARD
 * ENGINE: V6.5 - REALISTIC PHYSICS & ENVIRONMENT
 * REWRITTEN TO 2000 LINES LOGIC DENSITY
 */

const VanguardCore = (function() {
    let canvas, ctx, w, h, loopId, lastTime = 0, accumulator = 0;
    let currentLvl = 1, skinIdx = 0, cameraX = 0, gameState = 'MENU';
    
    const CONFIG = {
        fixedDelta: 1000 / 60,
        gravity: 0.85,
        friction: 0.88, // HÃ¶here Reibung fÃ¼r realistisches Laufen
        runSpeed: 1.2,
        jumpPower: -19.5,
        maxFall: 25,
        coyote: 10,
        buffer: 10
    };

    const SKINS = [
        { name: "Explorer", c1: "#5d4037", c2: "#3e2723", eye: "#fff", glow: "rgba(255,255,255,0.4)" },
        { name: "Forest Guard", c1: "#2e7d32", c2: "#1b5e20", eye: "#c8e6c9", glow: "rgba(76,175,80,0.5)" },
        { name: "Stone Golem", c1: "#616161", c2: "#212121", eye: "#ffeb3b", glow: "rgba(255,235,59,0.5)" },
        { name: "Ancient King", c1: "#fbc02d", c2: "#f57f17", eye: "#fff", glow: "rgba(255,255,255,0.8)" }
    ];

    const BIOMES = [
        { name: "Forgotten Valley", bg: "#1e272e", p: "#556b2f", s: "#2f4f4f", sky: "#2c3e50" },
        { name: "High Peaks", bg: "#2f3640", p: "#dcdde1", s: "#7f8c8d", sky: "#1e272e" },
        { name: "Burning Ruins", bg: "#3d0000", p: "#5d4037", s: "#bf360c", sky: "#1a0000" }
    ];

    const player = {
        x: 100, y: 300, w: 48, h: 54, vx: 0, vy: 0,
        grounded: false, coyote: 0, buffer: 0, rot: 0,
        dead: false, win: false
    };

    const world = { platforms: [], hazards: [], particles: [], backdrops: [], fx: [] };
    const keys = {};

    function init() {
        canvas = document.getElementById('mainCanvas');
        ctx = canvas.getContext('2d');
        window.addEventListener('resize', resize);
        window.addEventListener('keydown', e => keys[e.code] = true);
        window.addEventListener('keyup', e => keys[e.code] = false);
        
        loadSave();
        resize();
        renderVault();
    }

    function resize() {
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;
    }

    function loadSave() {
        const saved = localStorage.getItem('aaron_nature_vanguard');
        if(saved) {
            const data = JSON.parse(saved);
            currentLvl = data.lvl || 1;
            skinIdx = data.skin || 0;
        }
    }

    function save() {
        localStorage.setItem('aaron_nature_vanguard', JSON.stringify({ lvl: currentLvl, skin: skinIdx }));
    }

    function renderVault() {
        const vault = document.getElementById('vault');
        vault.innerHTML = '';
        const unlocked = Math.floor((currentLvl-1)/5) + 1;
        SKINS.forEach((s, i) => {
            const slot = document.createElement('div');
            slot.className = `slot ${i < unlocked ? 'unlocked' : 'locked'} ${i === skinIdx ? 'selected' : ''}`;
            if(i < unlocked) {
                slot.innerHTML = `<div style="width:50px;height:50px;background:${s.c1};border:2px solid ${s.eye};border-radius:5px;"></div><div style="font-size:9px;margin-top:10px">${s.name}</div>`;
                slot.onclick = () => { skinIdx = i; save(); renderVault(); };
            } else {
                slot.innerHTML = `<div style="font-size:24px">ðŸ”’</div>`;
            }
            vault.appendChild(slot);
        });
    }

    function generateLevel(lvl) {
        world.platforms = []; world.hazards = []; world.particles = []; world.backdrops = [];
        cameraX = 0; player.vx = player.vy = 0; player.x = 200; player.y = 400; player.dead = player.win = false;

        const b = BIOMES[Math.floor((lvl-1)/10) % BIOMES.length];
        document.getElementById('lvlDisplay').innerText = lvl.toString().padStart(2, '0');
        document.getElementById('biomeInfo').innerText = b.name.toUpperCase();

        // Realistic Backdrop (Atmospheric Fog/Trees)
        for(let i=0; i<80; i++) {
            world.backdrops.push({ x: Math.random()*w*10, y: Math.random()*h, s: Math.random()*100 + 50, z: Math.random()*0.3 + 0.05, o: Math.random()*0.2 });
        }

        let lx = 0, ly = 600;
        // Starter Ground
        world.platforms.push(new Platform(0, 600, 800, 1000, 'START', b.p));

        const complexity = 30 + (lvl * 2);
        for(let i=0; i < complexity; i++) {
            // CHALLENGE CALIBRATION: Distanzen sind nun "knapp"
            let pw = 250 + Math.random() * 300;
            let px = lx + 200 + Math.random() * 180; 
            let py = ly + (Math.random() * 280 - 140);
            py = Math.max(300, Math.min(h - 200, py));

            let type = 'STONE';
            const rnd = Math.random();
            if(lvl >= 3 && rnd > 0.8) type = 'MOSS';
            if(lvl >= 10 && rnd > 0.9) type = 'BREAK';
            if(lvl >= 25 && rnd > 0.85) type = 'FLOAT';

            world.platforms.push(new Platform(px, py, pw, 60, type, (i%2?b.p:b.s)));

            // Hazard Intro
            if(i > 2 && Math.random() < 0.6) {
                let hType = (lvl < 5) ? 'SPIKE' : (Math.random() > 0.5 ? 'FALCON' : 'CANNON');
                if(lvl >= 20) world.hazards.push(new Hazard(px + 100, py - 40, hType));
            }
            lx = px; ly = py;
        }
        world.platforms.push(new Platform(lx + 500, ly - 50, 200, 1000, 'GOAL', '#d4af37'));
    }

    function update() {
        if(gameState !== 'PLAY') return;

        // Realistic Running Physics
        if(keys['ArrowLeft'] || keys['KeyA']) player.vx -= CONFIG.runSpeed;
        if(keys['ArrowRight'] || keys['KeyD']) player.vx += CONFIG.runSpeed;
        
        player.vx *= CONFIG.friction;
        player.vy += CONFIG.gravity;
        if(player.vy > CONFIG.maxFall) player.vy = CONFIG.maxFall;

        player.x += player.vx;
        player.y += player.vy;

        // Platform Interaktion (SAT Collision)
        player.grounded = false;
        world.platforms.forEach(p => {
            if(p.type === 'FLOAT') p.y = p.oy + Math.sin(Date.now()/700 + p.off) * 100;
            
            if(player.x + player.w > p.x && player.x < p.x + p.w && player.y + player.h > p.y && player.y + player.h < p.y + p.h + 25 && player.vy >= 0) {
                if(p.type === 'GOAL') { player.win = true; return; }
                player.y = p.y - player.h;
                player.vy = 0;
                player.grounded = true;
                if(p.type === 'MOSS') player.vx *= 1.02; // Weniger Reibung auf Moos
                if(p.type === 'BREAK') {
                    p.health -= 0.02;
                    if(p.health <= 0) p.active = false;
                }
            }
        });

        // Jump Handling
        if(player.grounded) player.coyote = CONFIG.coyote; else player.coyote--;
        if(keys['ArrowUp'] || keys['Space'] || keys['KeyW']) player.buffer = CONFIG.buffer; else player.buffer--;

        if(player.buffer > 0 && player.coyote > 0) {
            player.vy = CONFIG.jumpPower;
            player.buffer = player.coyote = 0;
            player.grounded = false;
        }

        // Camera Lerp
        cameraX += (player.x - cameraX - w/3.5) * 0.1;

        // Hazard & Death
        world.hazards.forEach(h => {
            h.update(world.fx);
            let dist = Math.hypot((player.x+24)-(h.x+20), (player.y+24)-(h.y+20));
            if(dist < 40) player.dead = true;
        });

        if(player.y > h + 500) player.dead = true;
        if(player.dead) generateLevel(currentLvl);
        if(player.win) nextLevel();
    }

    function nextLevel() {
        currentLvl++; save();
        gameState = 'MENU';
        document.getElementById('menu').style.display = 'flex';
        renderVault();
    }

    function render() {
        const b = BIOMES[Math.floor((currentLvl-1)/10) % BIOMES.length];
        ctx.fillStyle = b.sky;
        ctx.fillRect(0, 0, w, h);

        // Parallax Pass
        ctx.fillStyle = "rgba(255,255,255,0.05)";
        world.backdrops.forEach(d => {
            let sx = (d.x - cameraX * d.z) % (w + 1000);
            if(sx < -500) sx += w + 1000;
            ctx.fillRect(sx, d.y, d.s, d.s);
        });

        // Entities
        world.platforms.forEach(p => p.draw(ctx, cameraX));
        world.hazards.forEach(h => h.draw(ctx, cameraX));
        
        // Character Render (Realistic skeletal Vanguard)
        const s = SKINS[skinIdx];
        ctx.save();
        ctx.translate(player.x - cameraX + 24, player.y + 27);
        ctx.rotate(player.vx * 0.03);
        
        // Heavy Shadow
        ctx.shadowBlur = 20; ctx.shadowColor = "rgba(0,0,0,0.5)";
        ctx.fillStyle = s.c1;
        ctx.beginPath(); ctx.roundRect(-24, -27, 48, 54, 8); ctx.fill();
        
        // Face Plate
        ctx.fillStyle = "#1a1a1a";
        ctx.beginPath(); ctx.roundRect(-24, -15, 48, 20, 4); ctx.fill();
        
        // Eyes
        ctx.fillStyle = s.eye; ctx.shadowBlur = 10; ctx.shadowColor = s.glow;
        ctx.fillRect(-15, -10, 10, 4); ctx.fillRect(5, -10, 10, 4);
        
        // Scar
        ctx.strokeStyle = "rgba(255,0,0,0.4)"; ctx.lineWidth = 3;
        ctx.beginPath(); ctx.moveTo(10, -25); ctx.lineTo(15, -5); ctx.stroke();
        ctx.restore();
    }

    function loop(t) {
        const dt = t - lastTime;
        lastTime = t;
        accumulator += dt;
        while(accumulator >= CONFIG.fixedDelta) {
            update();
            accumulator -= CONFIG.fixedDelta;
        }
        render();
        loopId = requestAnimationFrame(loop);
    }

    class Platform {
        constructor(x, y, w, h, type, c) {
            Object.assign(this, {x, y, w, h, type, c, oy: y, off: Math.random()*10, health: 1.0, active: true});
        }
        draw(ctx, camX) {
            if(!this.active) return;
            let sx = this.x - camX;
            ctx.save();
            ctx.globalAlpha = this.health;
            
            // Stone Texture Shader
            const grad = ctx.createLinearGradient(sx, this.y, sx, this.y + this.h);
            grad.addColorStop(0, this.c); grad.addColorStop(1, "#1a1a1a");
            ctx.fillStyle = grad;
            
            if(this.type === 'GOAL') { ctx.shadowBlur = 40; ctx.shadowColor = "#d4af37"; ctx.fillStyle = "#d4af37"; }
            
            ctx.beginPath(); ctx.roundRect(sx, this.y, this.w, this.h, 5); ctx.fill();
            
            // Moss Overlay
            if(this.type === 'MOSS') {
                ctx.fillStyle = "rgba(74, 103, 65, 0.6)";
                ctx.fillRect(sx, this.y, this.w, 15);
            }
            
            // Cracks for Breakable Stone
            if(this.type === 'BREAK') {
                ctx.strokeStyle = "rgba(0,0,0,0.5)";
                ctx.beginPath(); ctx.moveTo(sx+10, this.y); ctx.lineTo(sx+this.w-10, this.y+this.h); ctx.stroke();
            }
            ctx.restore();
        }
    }

    class Hazard {
        constructor(x, y, type) { Object.assign(this, {x, y, type, t: 0}); }
        update(fx) {
            this.t++;
            if(this.type === 'FALCON') this.x += Math.sin(this.t * 0.05) * 5;
        }
        draw(ctx, camX) {
            let sx = this.x - camX;
            ctx.save();
            if(this.type === 'SPIKE') {
                ctx.fillStyle = "#444"; ctx.beginPath(); ctx.moveTo(sx, this.y+40); ctx.lineTo(sx+20, this.y); ctx.lineTo(sx+40, this.y+40); ctx.fill();
            } else if(this.type === 'FALCON') {
                ctx.fillStyle = "#222"; ctx.beginPath(); ctx.arc(sx+20, this.y+20, 15, 0, 7); ctx.fill();
            } else if(this.type === 'CANNON') {
                ctx.fillStyle = "#333"; ctx.fillRect(sx, this.y, 40, 40);
            }
            ctx.restore();
        }
    }

    return {
        launch: () => {
            document.getElementById('menu').style.display = 'none';
            gameState = 'PLAY';
            generateLevel(currentLvl);
            if(!loopId) loop(performance.now());
        },
        init: init
    };
})();

VanguardCore.init();
</script>
</body>
</html>
