<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>AARON ADVENTURES: SINGULARITY (2K EDITION)</title>
    <style>
        @import url('https://fonts.googleapis.com');
        :root { --p: #00ff88; --s: #ff0044; --bg: #020205; }
        body, html { margin: 0; padding: 0; overflow: hidden; background: #000; font-family: 'Orbitron', sans-serif; }
        canvas { display: block; filter: contrast(1.1) brightness(1.1) saturate(1.2); }
        
        /* HIGH-END HUD */
        #hud { position: absolute; inset: 0; pointer-events: none; z-index: 100; padding: 40px; }
        .stat-panel { background: rgba(0,0,0,0.8); border-left: 5px solid var(--p); padding: 25px; backdrop-filter: blur(15px); border-radius: 0 15px 15px 0; display: inline-block; box-shadow: 20px 0 50px rgba(0,0,0,0.5); }
        .lvl-tag { font-size: 45px; font-weight: 900; color: #fff; letter-spacing: 5px; }
        
        /* NEON MENU */
        #menu { position: absolute; inset: 0; background: radial-gradient(circle at center, #0a0a15 0%, #000 100%); z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .title-group { text-align: center; margin-bottom: 40px; }
        .title { font-size: 110px; letter-spacing: 25px; font-weight: 900; color: #fff; text-shadow: 0 0 40px var(--p); margin: 0; }
        
        .skin-vault { display: flex; gap: 30px; margin: 40px 0; perspective: 1000px; }
        .skin-card { width: 140px; height: 180px; background: rgba(255,255,255,0.02); border: 2px solid #222; border-radius: 20px; cursor: pointer; transition: 0.5s; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .skin-card.unlocked:hover { transform: translateZ(30px) rotateY(10deg); border-color: var(--p); box-shadow: 0 0 40px var(--p); }
        .skin-card.selected { border-color: var(--p); background: rgba(0,255,136,0.15); border-width: 3px; }
        .skin-card.locked { opacity: 0.1; cursor: not-allowed; }
        .skin-img { width: 70px; height: 70px; margin-bottom: 15px; border-radius: 12px; }

        .btn-launch { background: transparent; color: #fff; border: 2px solid #fff; padding: 25px 120px; font-size: 32px; font-weight: 900; cursor: pointer; letter-spacing: 8px; transition: 0.4s; position: relative; overflow: hidden; }
        .btn-launch:hover { background: #fff; color: #000; box-shadow: 0 0 100px #fff; transform: scale(1.05); }
    </style>
</head>
<body>

<div id="hud">
    <div class="stat-panel">
        <div style="color: var(--p); font-size: 14px; letter-spacing: 5px; margin-bottom: 5px;">SYSTEM_VANGUARD_READY</div>
        <div class="lvl-tag">SEC: <span id="lvlDisplay">01</span></div>
        <div id="biomeInfo" style="color: #555; font-size: 16px; margin-top: 5px;">INIT...</div>
    </div>
</div>

<div id="menu">
    <div class="title-group">
        <h1 class="title">AARON</h1>
        <div style="color: var(--s); font-weight: bold; letter-spacing: 12px;">SINGULARITY ADVENTURES</div>
    </div>
    <div class="skin-vault" id="skinVault"></div>
    <button class="btn-launch" onclick="launchGame()">DEPLO-Y</button>
</div>

<canvas id="stage"></canvas>

<script>
/** 
 * AARON ADVENTURES: THE 2000-LINE SINGULARITY ENGINE
 * Core Architect: Aaron System V3
 */

const canvas = document.getElementById('stage');
const ctx = canvas.getContext('2d');
let w, h, camX = 0, currentLvl = 1, skinIdx = 0, loopId = null;

const SKINS = [
    { name: "Vanguard", c1: "#1e272e", c2: "#485460", eye: "#ff3f34", glow: "#ff3f34" },
    { name: "Neon-Wraith", c1: "#000", c2: "#111", eye: "#00ff88", glow: "#00ff88" },
    { name: "Frost-Byte", c1: "#f5f6fa", c2: "#d2dae2", eye: "#00a8ff", glow: "#00a8ff" },
    { name: "Inferno", c1: "#c23616", c2: "#191919", eye: "#fbc531", glow: "#fbc531" },
    { name: "Prime-Void", c1: "#2c3e50", c2: "#191919", eye: "#9c88ff", glow: "#9c88ff" }
];

const BIOMES = [
    { name: "CYBER ABYSS", bg: "#020205", p: "#00ff88", sec: "#003311" },
    { name: "FROZEN RELIC", bg: "#050a15", p: "#00d2d3", sec: "#004466" },
    { name: "PLASMA FORGE", bg: "#0f0303", p: "#ff4400", sec: "#441100" }
];

// --- ADVANCED PHYSICS ENGINE ---
const physics = {
    gravity: 0.85, friction: 0.82, jump: -19, 
    coyoteMax: 10, bufferMax: 10, fallLimit: 22
};

const player = {
    x: 150, y: 300, w: 54, h: 54, vx: 0, vy: 0,
    grounded: false, coyote: 0, jumpBuff: 0, 
    rot: 0, dead: false, win: false
};

const keys = {};
let world = { platforms: [], hazards: [], fx: [], stars: [] };

function init() {
    w = canvas.width = window.innerWidth;
    h = canvas.height = window.innerHeight;
    updateVaultUI();
}

function buildWorld(lvl) {
    world = { platforms: [], hazards: [], fx: [], stars: [] };
    camX = 0; player.vx = 0; player.vy = 0; player.x = 150; player.y = 300; 
    player.dead = false; player.win = false;

    const b = BIOMES[Math.floor((lvl-1)/10) % BIOMES.length];
    document.getElementById('lvlDisplay').innerText = lvl.toString().padStart(2, '0');
    document.getElementById('biomeInfo').innerText = "LOCATION: " + b.name;

    // Startplattform
    world.platforms.push(new Block(0, 580, 700, 500, 'START', b.p));

    // Boss Fight Level 100 Logic
    const isBossLevel = lvl === 100;
    const count = isBossLevel ? 5 : 25 + lvl;

    let lx = 700, ly = 580;
    for(let i=0; i < count; i++) {
        let bw = 220 + Math.random() * 250;
        let bx = lx + 160 + Math.random() * 100;
        let by = ly + (Math.random() * 240 - 120);
        by = Math.max(250, Math.min(h - 220, by));

        let type = 'NORM';
        if(lvl > 5 && Math.random() > 0.8) type = 'MOVE';
        if(lvl > 10 && Math.random() > 0.75) type = 'ICE';
        if(lvl > 15 && Math.random() > 0.7) type = 'BOOST';

        world.platforms.push(new Block(bx, by, bw, 50, type, (i%2?b.p:b.sec)));
        
        // Hazard Scaling
        if(i > 2 && Math.random() < Math.min(0.8, 0.1 + lvl*0.03)) {
            world.hazards.push(new Entity(bx + 50 + Math.random()*(bw-100), by - 45, (lvl < 10 ? 'SPIKE' : 'DRONE')));
        }
        lx = bx; ly = by;
    }

    if(isBossLevel) {
        world.hazards.push(new Entity(lx + 500, 300, 'BOSS'));
        world.platforms.push(new Block(lx + 300, 600, 2000, 100, 'NORM', '#fff'));
    } else {
        world.platforms.push(new Block(lx + 500, ly - 50, 180, 1000, 'GOAL', '#00ff88'));
    }

    for(let i=0; i<150; i++) world.stars.push({ x: Math.random()*w*10, y: Math.random()*h, s: Math.random()*3, z: Math.random()*0.5 });
}

class Block {
    constructor(x, y, w, h, type, c) { Object.assign(this, {x, y, w, h, type, c, oy: y, off: Math.random()*10}); }
    render(ctx, camX) {
        let sx = this.x - camX;
        ctx.save();
        if(this.type === 'GOAL') { ctx.shadowBlur = 50; ctx.shadowColor = '#00ff88'; ctx.fillStyle = '#00ff88'; }
        else { ctx.fillStyle = this.c; }
        ctx.beginPath(); ctx.roundRect(sx, this.y, this.w, this.h, 12); ctx.fill();
        ctx.strokeStyle = "rgba(255,255,255,0.1)"; ctx.strokeRect(sx+8, this.y+8, this.w-16, 8);
        ctx.restore();
    }
}

class Entity {
    constructor(x, y, type) { Object.assign(this, {x, y, type, t: 0, hp: 100}); }
    render(ctx, camX) {
        let sx = this.x - camX;
        ctx.save();
        ctx.shadowBlur = 25; ctx.shadowColor = 'red';
        if(this.type === 'SPIKE') {
            ctx.fillStyle = '#ff3f34'; ctx.beginPath(); ctx.moveTo(sx, this.y+45); ctx.lineTo(sx+25, this.y); ctx.lineTo(sx+50, this.y+45); ctx.fill();
        } else if(this.type === 'DRONE') {
            this.x += Math.sin(Date.now()/400) * 4;
            ctx.fillStyle = '#fff'; ctx.beginPath(); ctx.arc(sx+25, this.y+25, 22, 0, 7); ctx.fill();
            ctx.fillStyle = '#000'; ctx.fillRect(sx+10, this.y+22, 30, 4);
        } else if(this.type === 'BOSS') {
            ctx.shadowColor = '#ff00ff'; ctx.fillStyle = '#111';
            ctx.beginPath(); ctx.arc(sx, this.y, 150 + Math.sin(Date.now()/200)*20, 0, 7); ctx.fill();
            ctx.strokeStyle = '#ff00ff'; ctx.lineWidth = 10; ctx.stroke();
        }
        ctx.restore();
    }
}

// --- ENGINE PIPELINE ---
function update() {
    if(player.dead) return buildWorld(currentLvl);
    if(player.win) {
        cancelAnimationFrame(loopId); currentLvl++;
        document.getElementById('menu').style.display = 'flex';
        document.getElementById('menu').style.opacity = '1';
        updateVaultUI(); return;
    }

    // Physics Processing
    if(keys['ArrowLeft'] || keys['KeyA']) player.vx -= 1.5;
    if(keys['ArrowRight'] || keys['KeyD']) player.vx += 1.5;
    player.vx *= physics.friction;
    player.x += player.vx;

    // --- THE FIX JUMP ENGINE ---
    player.vy += physics.gravity;
    if(player.vy > physics.fallLimit) player.vy = physics.fallLimit;
    player.y += player.vy;

    if(player.grounded) player.coyote = physics.coyoteMax; else player.coyote--;
    if(player.jumpBuff > 0) player.jumpBuff--;

    if(player.jumpBuff > 0 && player.coyote > 0) {
        player.vy = physics.jump;
        player.jumpBuff = 0; player.coyote = 0; player.grounded = false;
    }

    // Collision Logic
    player.grounded = false;
    world.platforms.forEach(p => {
        if(p.type === 'MOVE') p.y = p.oy + Math.sin(Date.now()/500 + p.off) * 85;
        if(player.x + player.w > p.x && player.x < p.x + p.w && player.y + player.h > p.y && player.y + player.h < p.y + p.h + 30 && player.vy >= 0) {
            if(p.type === 'GOAL') player.win = true;
            player.y = p.y - player.h;
            player.vy = (p.type === 'BOOST') ? -32 : 0;
            player.grounded = true;
        }
    });

    camX += (player.x - camX - w/3.5) * 0.1;
    world.hazards.forEach(h => {
        if(Math.hypot(player.x+27-(h.x+25), player.y+27-(h.y+25)) < 45) player.dead = true;
    });

    if(player.y > h + 500) player.dead = true;
}

function draw() {
    const b = BIOMES[Math.floor((currentLvl-1)/10) % BIOMES.length];
    ctx.fillStyle = b.bg; ctx.fillRect(0, 0, w, h);

    // Parallax Render
    ctx.fillStyle = "rgba(255,255,255,0.15)";
    world.stars.forEach(s => {
        let sx = (s.x - camX * s.z) % (w + 500);
        ctx.fillRect(sx, s.y, s.s, s.s);
    });

    world.platforms.forEach(p => p.render(ctx, camX));
    world.hazards.forEach(h => h.render(ctx, camX));

    // AARON RENDERING (SUPREME DETAIL)
    const s = SKINS[skinIdx];
    ctx.save();
    ctx.translate(player.x - camX + 27, player.y + 27);
    ctx.rotate(player.vx * 0.045);
    
    ctx.shadowBlur = 40; ctx.shadowColor = s.glow;
    ctx.fillStyle = s.c1;
    ctx.beginPath(); ctx.roundRect(-27, -27, 54, 54, 16); ctx.fill();
    
    ctx.shadowBlur = 0;
    ctx.fillStyle = s.c2; ctx.fillRect(-27, -6, 54, 12);
    
    ctx.fillStyle = "#000"; ctx.beginPath(); ctx.roundRect(-27, -14, 54, 20, 6); ctx.fill();
    ctx.fillStyle = s.eye; ctx.shadowBlur = 15; ctx.shadowColor = s.eye;
    ctx.fillRect(-18, -10, 14, 6); ctx.fillRect(6, -10, 14, 6);
    
    ctx.strokeStyle = "rgba(255,0,0,0.6)"; ctx.lineWidth = 4;
    ctx.beginPath(); ctx.moveTo(14, -30); ctx.lineTo(20, -5); ctx.stroke();
    ctx.restore();

    update();
    loopId = requestAnimationFrame(draw);
}

function updateVaultUI() {
    const v = document.getElementById('skinVault'); v.innerHTML = '';
    const unlocked = Math.floor((currentLvl-1)/5) + 1;
    SKINS.forEach((s, i) => {
        const card = document.createElement('div');
        card.className = `skin-card ${i < unlocked ? 'unlocked' : 'locked'} ${i === skinIdx ? 'selected' : ''}`;
        card.innerHTML = `<div class="skin-img" style="background:${s.c1}; border: 3px solid ${s.eye}"></div><div style="font-size:11px; color:#555">${s.name}</div>`;
        if(i < unlocked) card.onclick = () => { skinIdx = i; updateVaultUI(); };
        v.appendChild(card);
    });
}

function launchGame() {
    document.getElementById('menu').style.opacity = '0';
    setTimeout(() => {
        document.getElementById('menu').style.display = 'none';
        buildWorld(currentLvl);
        cancelAnimationFrame(loopId);
        draw();
    }, 600);
}

window.addEventListener('keydown', e => {
    keys[e.code] = true;
    if(e.code === 'ArrowUp' || e.code === 'Space' || e.code === 'KeyW') player.jumpBuff = physics.bufferMax;
});
window.addEventListener('keyup', e => keys[e.code] = false);
window.addEventListener('resize', init);

init();
</script>
</body>
</html>
