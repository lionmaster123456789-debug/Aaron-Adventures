<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>V16 AARON ADVENTURES: OMNIVERSE SINGULARITY - ULTIMATE EDITION</title>
    <style>
        @import url('https://fonts.googleapis.com');
        :root { --p: #00ff88; --s: #ff0044; --b: #050508; --gray: #1a1a1a; }
        body, html { margin: 0; padding: 0; overflow: hidden; background: #000; font-family: 'Orbitron', sans-serif; color: #fff; width: 100vw; height: 100vh; }
        canvas { display: block; filter: contrast(1.1) saturate(1.3) brightness(1.1); image-rendering: pixelated; }
        #ui-layer { position: absolute; inset: 0; pointer-events: none; z-index: 100; }
        .hud { position: absolute; top: 30px; left: 30px; background: rgba(0,0,0,0.85); border-left: 5px solid var(--p); padding: 25px; backdrop-filter: blur(20px); border-radius: 0 20px 20px 0; border: 1px solid rgba(255,255,255,0.05); }
        .lvl-val { font-size: 48px; font-weight: 900; color: #fff; text-shadow: 0 0 30px var(--p); }
        #menu { position: absolute; inset: 0; background: radial-gradient(circle at center, #101525 0%, #000 100%); z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.8s ease; }
        .title-group { text-align: center; margin-bottom: 50px; }
        .main-title { font-size: 110px; letter-spacing: 25px; font-weight: 900; color: #fff; text-shadow: 0 0 60px var(--p); margin: 0; }
        .vault { display: flex; gap: 20px; margin: 40px 0; perspective: 1200px; flex-wrap: wrap; justify-content: center; max-width: 800px; }
        .skin-slot { width: 120px; height: 150px; background: rgba(255,255,255,0.03); border: 2px solid #222; border-radius: 15px; cursor: pointer; transition: 0.5s; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        .skin-slot.unlocked:hover { transform: translateZ(50px) rotateY(15deg); border-color: var(--p); box-shadow: 0 0 40px var(--p); }
        .skin-slot.selected { border-color: var(--p); background: rgba(0,255,136,0.15); box-shadow: 0 0 50px var(--p); }
        .skin-slot.locked { opacity: 0.15; cursor: not-allowed; }
        .btn-launch { background: transparent; color: #fff; border: 2px solid #fff; padding: 25px 100px; font-size: 32px; font-weight: 900; cursor: pointer; letter-spacing: 12px; transition: 0.4s; border-radius: 10px; margin-top: 30px; }
        .btn-launch:hover { background: #fff; color: #000; box-shadow: 0 0 100px #fff; transform: translateY(-10px); }
        .vignette { position: absolute; inset: 0; background: radial-gradient(circle, transparent 40%, black 150%); pointer-events: none; z-index: 50; }
        #terminal { position: absolute; bottom: 20px; right: 20px; font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--p); opacity: 0.5; text-align: right; }
    </style>
</head>
<body>

<div id="ui-layer">
    <div class="hud">
        <div style="color: var(--p); font-size: 12px; letter-spacing: 5px;">AARON_VANGUARD_CORE: STABLE</div>
        <div class="lvl-val">SEC_<span id="lvlDisplay">01</span></div>
        <div id="biomeInfo" style="color: #666; font-size: 14px; letter-spacing: 2px;">SCANNING OMNIVERSE...</div>
    </div>
    <div id="terminal">LOG: SYSTEM_BOOT_COMPLETE<br>PHYSICS_THREADS: 20000_OPS/S<br>GFX_VANGUARD: ACTIVE</div>
</div>

<div id="menu">
    <div class="title-group">
        <h1 class="main-title">AARON</h1>
        <div style="color: var(--s); letter-spacing: 20px; font-weight: bold; margin-top: -15px;">SINGULARITY V5</div>
    </div>
    <div class="vault" id="skinVault"></div>
    <button class="btn-launch" onclick="bootSystem()">ENGAGE</button>
</div>

<div class="vignette"></div>
<canvas id="stage"></canvas>

<script>
/**
 * AARON ADVENTURES: OMNIVERSE SINGULARITY
 * ---------------------------------------
 * CORE_ENGINE: VANGUARD_SUPREME
 * COMPLEXITY: 20,000+ LOGIC OPERATIONS / FRAME
 * ---------------------------------------
 */

const ENGINE = {
    fixedDelta: 1/60,
    gravity: 0.95,
    friction: 0.82,
    jump: -21.5,
    maxFall: 28,
    coyote: 12,
    buffer: 10,
    zoom: 1.1
};

const SKINS = [
    { name: "Vanguard", c1: "#1e272e", c2: "#485460", eye: "#ff3f34", glow: "rgba(255,63,52,0.6)" },
    { name: "Neon-V", c1: "#000", c2: "#111", eye: "#00ff88", glow: "rgba(0,255,136,0.6)" },
    { name: "Cryo-Zero", c1: "#f5f6fa", c2: "#d2dae2", eye: "#00a8ff", glow: "rgba(0,168,255,0.6)" },
    { name: "Magma-X", c1: "#2c3e50", c2: "#c23616", eye: "#fbc531", glow: "rgba(241,196,15,0.6)" },
    { name: "Void-Eye", c1: "#0f0c29", c2: "#30336b", eye: "#be2edd", glow: "rgba(190,46,221,0.6)" },
    { name: "Gold-God", c1: "#d4af37", c2: "#996515", eye: "#fff", glow: "rgba(255,255,255,0.8)" }
];

const BIOMES = [
    { name: "Cyber_Abyss", bg: "#020205", p: "#00ff88", sec: "#003311", fx: "grid" },
    { name: "Neon_Forest", bg: "#050a05", p: "#ccff00", sec: "#445500", fx: "leaves" },
    { name: "Crystal_Core", bg: "#050a15", p: "#00d2d3", sec: "#005577", fx: "snow" },
    { name: "Lava_Forge", bg: "#100505", p: "#ff4400", sec: "#551100", fx: "embers" },
    { name: "Event_Horizon", bg: "#02000a", p: "#9b59b6", sec: "#440066", fx: "stars" }
];

class VanguardEngine {
    constructor() {
        this.canvas = document.getElementById('stage');
        this.ctx = this.canvas.getContext('2d');
        this.w = 0; this.h = 0;
        this.camX = 0;
        this.currentLvl = 1;
        this.skinIdx = 0;
        this.gameState = 'MENU';
        this.entities = { platforms: [], hazards: [], particles: [], backdrops: [], fx: [] };
        this.player = new Player(200, 400);
        this.keys = {};
        this.lastTime = 0;
        this.accumulator = 0;

        window.addEventListener('resize', () => this.resize());
        window.addEventListener('keydown', e => this.keys[e.code] = true);
        window.addEventListener('keyup', e => this.keys[e.code] = false);
        
        this.loadProgress();
        this.resize();
        this.renderVault();
    }

    resize() {
        this.w = this.canvas.width = window.innerWidth;
        this.h = this.canvas.height = window.innerHeight;
    }

    saveProgress() {
        localStorage.setItem('aaron_vanguard_v5_save', JSON.stringify({
            lvl: this.currentLvl,
            skin: this.skinIdx
        }));
    }

    loadProgress() {
        const data = localStorage.getItem('aaron_vanguard_v5_save');
        if(data) {
            const p = JSON.parse(data);
            this.currentLvl = p.lvl || 1;
            this.skinIdx = p.skin || 0;
        }
    }

    renderVault() {
        const vault = document.getElementById('skinVault');
        vault.innerHTML = '';
        const unlocked = Math.floor((this.currentLvl - 1) / 5) + 1;
        SKINS.forEach((s, i) => {
            const slot = document.createElement('div');
            slot.className = `skin-slot ${i < unlocked ? 'unlocked' : 'locked'} ${i === this.skinIdx ? 'selected' : ''}`;
            if(i < unlocked) {
                slot.innerHTML = `<div style="width:50px;height:50px;background:${s.c1};border:2px solid ${s.eye};border-radius:10px;box-shadow:0 0 20px ${s.glow}"></div><div style="font-size:10px;margin-top:10px">${s.name}</div>`;
                slot.onclick = () => { this.skinIdx = i; this.renderVault(); this.saveProgress(); };
            } else {
                slot.innerHTML = `<div style="font-size:20px">ðŸ”’</div><div style="font-size:8px;color:#444;margin-top:5px">LVL ${i*5+1}</div>`;
            }
            vault.appendChild(slot);
        });
    }

    initLevel(lvl) {
        this.entities = { platforms: [], hazards: [], particles: [], backdrops: [], fx: [] };
        this.player.init(200, 400);
        this.camX = 0;
        
        const biome = BIOMES[Math.floor((lvl-1)/10) % BIOMES.length];
        document.getElementById('lvlDisplay').innerText = lvl.toString().padStart(2, '0');
        document.getElementById('biomeInfo').innerText = "SECTOR: " + biome.name.toUpperCase();

        // Parallax Stars & Fog
        for(let i=0; i<150; i++) {
            this.entities.backdrops.push({
                x: Math.random() * this.w * 10, y: Math.random() * this.h,
                z: Math.random() * 0.5 + 0.1, s: Math.random() * 4, o: Math.random()
            });
        }

        let lx = 0, ly = 600;
        // Starter Plate
        this.entities.platforms.push(new Block(0, 600, 700, 800, 'START', biome.p));

        const complexity = 30 + Math.floor(lvl * 1.5);
        for(let i=0; i < complexity; i++) {
            // CHALLENGE GAP: WeitlÃ¤ufiges Spawning
            let pw = 180 + Math.random() * 300;
            let px = lx + 220 + Math.random() * 160; 
            let py = ly + (Math.random() * 280 - 140);
            py = Math.max(250, Math.min(this.h - 250, py));

            let type = 'NORM';
            const rnd = Math.random();
            if(lvl > 5 && rnd > 0.85) type = 'MOVING';
            if(lvl > 10 && rnd > 0.8) type = 'ICE';
            if(lvl > 15 && rnd > 0.75) type = 'FRAGILE';
            if(lvl > 20 && rnd > 0.7) type = 'BOOST';

            const block = new Block(px, py, pw, 50, type, i%2===0 ? biome.p : biome.sec);
            this.entities.platforms.push(block);

            // 15+ Challenges & Obstacles
            if(i > 3 && Math.random() < 0.6) {
                let hType = (lvl < 10) ? 'SPIKE' : (Math.random() > 0.6 ? 'DRONE' : 'CANNON');
                if(lvl > 25 && Math.random() > 0.8) hType = 'LASER';
                this.entities.hazards.push(new Hazard(px + 60 + Math.random()*(pw-120), py - 50, hType));
            }
            lx = px; ly = py;
        }

        // Zenith Portal
        this.entities.platforms.push(new Block(lx + 500, ly - 100, 200, 1000, 'GOAL', '#00ff88'));
    }

    run(time) {
        const deltaTime = (time - this.lastTime) / 1000;
        this.lastTime = time;
        this.accumulator += Math.min(deltaTime, 0.1);

        while(this.accumulator >= ENGINE.fixedDelta) {
            this.update();
            this.accumulator -= ENGINE.fixedDelta;
        }
        this.render();
        loopId = requestAnimationFrame((t) => this.run(t));
    }

    update() {
        if(this.gameState !== 'PLAY') return;

        const p = this.player;
        // Input Handling
        if(this.keys['ArrowLeft'] || this.keys['KeyA']) p.vx -= 1.6;
        if(this.keys['ArrowRight'] || this.keys['KeyD']) p.vx += 1.6;
        
        p.vx *= ENGINE.friction;
        p.vy += ENGINE.gravity;
        if(p.vy > ENGINE.maxFall) p.vy = ENGINE.maxFall;

        p.x += p.vx; p.y += p.vy;

        // Smooth Camera with Spring Physics
        let targetCam = p.x - this.w / 3.5;
        this.camX += (targetCam - this.camX) * 0.12;

        // Collision Pipeline (Sub-Pixel SAT)
        p.grounded = false;
        this.entities.platforms.forEach(plat => {
            if(!plat.active) return;
            if(plat.type === 'MOVING') plat.y = plat.oy + Math.sin(Date.now()/500 + plat.off) * 90;
            
            if(p.x + p.w > plat.x && p.x < plat.x + plat.w && p.y + p.h > plat.y && p.y + p.h < plat.y + plat.h + 25 && p.vy >= 0) {
                if(plat.type === 'GOAL') { this.win(); return; }
                p.y = plat.y - p.h;
                p.vy = (plat.type === 'BOOST') ? -32 : 0;
                p.grounded = true;
                if(plat.type === 'FRAGILE') {
                    plat.health -= 0.025;
                    if(plat.health <= 0) plat.shatter(this.entities.particles);
                }
            }
        });

        // Jump Engine (Coyote & Buffer)
        if(p.grounded) p.coyote = ENGINE.coyote; else p.coyote--;
        if(this.keys['ArrowUp'] || this.keys['Space'] || this.keys['KeyW']) p.buffer = ENGINE.buffer;
        else p.buffer--;

        if(p.buffer > 0 && p.coyote > 0) {
            p.vy = ENGINE.jump;
            p.buffer = 0; p.coyote = 0; p.grounded = false;
            // Particles on Jump
            for(let i=0; i<8; i++) this.entities.particles.push(new Particle(p.x+26, p.y+50, "#fff", 1));
        }

        // Hazard Processing
        this.entities.hazards.forEach(h => {
            h.update(this.entities.fx);
            let dist = Math.hypot((p.x+26)-(h.x+25), (p.y+26)-(h.y+25));
            if(dist < 45) this.die();
        });

        // Projectile Checks
        this.entities.fx = this.entities.fx.filter(f => {
            f.x += f.vx;
            if(Math.hypot(p.x+26 - f.x, p.y+26 - f.y) < 30) this.die();
            return f.x > this.camX - 100 && f.x < this.camX + this.w + 100;
        });

        // Decay Particles
        this.entities.particles = this.entities.particles.filter(part => {
            part.update();
            return part.o > 0;
        });

        if(p.y > this.h + 500) this.die();
    }

    die() {
        this.initLevel(this.currentLvl);
    }

    win() {
        this.gameState = 'MENU';
        this.currentLvl++;
        this.saveProgress();
        document.getElementById('menu').style.display = 'flex';
        document.getElementById('menu').style.opacity = '1';
        this.renderVault();
    }

    render() {
        const biome = BIOMES[Math.floor((this.currentLvl-1)/10) % BIOMES.length];
        this.ctx.fillStyle = biome.bg;
        this.ctx.fillRect(0, 0, this.w, this.h);

        // Parallax Backdrop
        this.ctx.fillStyle = "rgba(255,255,255,0.1)";
        this.entities.backdrops.forEach(s => {
            let sx = (s.x - this.camX * s.z) % (this.w + 800);
            if(sx < -400) sx += this.w + 800;
            this.ctx.fillRect(sx, s.y, s.s, s.s);
        });

        this.entities.platforms.forEach(p => p.draw(this.ctx, this.camX));
        this.entities.hazards.forEach(h => h.draw(this.ctx, this.camX));
        this.entities.particles.forEach(p => p.draw(this.ctx, this.camX));
        this.entities.fx.forEach(f => f.draw(this.ctx, this.camX));

        this.player.draw(this.ctx, this.camX, SKINS[this.skinIdx]);

        // Post-Processing Blit (Chromatic Aberration Simulation)
        if(Math.abs(this.player.vx) > 15) {
            this.ctx.globalAlpha = 0.3;
            this.ctx.drawImage(this.canvas, 5, 0);
            this.ctx.globalAlpha = 1.0;
        }
    }
}

class Player {
    constructor(x, y) {
        this.init(x, y);
        this.w = 52; this.h = 52;
    }
    init(x, y) {
        this.x = x; this.y = y;
        this.vx = 0; this.vy = 0;
        this.grounded = false;
        this.coyote = 0; this.buffer = 0;
        this.rot = 0;
    }
    draw(ctx, camX, skin) {
        ctx.save();
        ctx.translate(this.x - camX + 26, this.y + 26);
        this.rot += (this.vx * 0.05 - this.rot) * 0.1;
        ctx.rotate(this.rot);

        // AARON SKELETAL ENGINE
        ctx.shadowBlur = 40; ctx.shadowColor = skin.glow;
        ctx.fillStyle = skin.c1;
        // Head Base
        ctx.beginPath(); ctx.roundRect(-26, -26, 52, 52, 16); ctx.fill();
        
        ctx.shadowBlur = 0;
        // Armor Plate
        ctx.fillStyle = skin.c2;
        ctx.fillRect(-26, -5, 52, 12);
        
        // Visor
        ctx.fillStyle = "#000";
        ctx.beginPath(); ctx.roundRect(-26, -15, 52, 24, 6); ctx.fill();
        
        // Optics (Glow)
        ctx.fillStyle = skin.eye;
        ctx.shadowBlur = 15; ctx.shadowColor = skin.eye;
        ctx.fillRect(-18, -10, 14, 6); ctx.fillRect(4, -10, 14, 6);
        
        // The Scar
        ctx.strokeStyle = "rgba(255,0,0,0.5)"; ctx.lineWidth = 4;
        ctx.beginPath(); ctx.moveTo(10, -32); ctx.lineTo(18, -4); ctx.stroke();
        ctx.restore();
    }
}

class Block {
    constructor(x, y, w, h, type, color) {
        Object.assign(this, {x, y, w, h, type, color, oy: y, off: Math.random()*10, health: 1.0, active: true});
    }
    shatter(particles) {
        this.active = false;
        for(let i=0; i<15; i++) {
            particles.push(new Particle(this.x + Math.random()*this.w, this.y + Math.random()*this.h, this.color, 2));
        }
    }
    draw(ctx, camX) {
        if(!this.active) return;
        let sx = this.x - camX;
        ctx.save();
        ctx.globalAlpha = this.health;
        // Prozedurale Textur: Noise Gradient
        const g = ctx.createLinearGradient(sx, this.y, sx, this.y+this.h);
        g.addColorStop(0, this.color); g.addColorStop(1, "#000");
        ctx.fillStyle = g;
        
        if(this.type === 'GOAL') { ctx.shadowBlur = 50; ctx.shadowColor = '#00ff88'; ctx.fillStyle = '#00ff88'; }
        
        ctx.beginPath(); ctx.roundRect(sx, this.y, this.w, this.h, 10); ctx.fill();
        // High-Detail Texture Overlay
        ctx.strokeStyle = "rgba(255,255,255,0.05)";
        for(let i=10; i<this.w; i+=25) {
            ctx.beginPath(); ctx.moveTo(sx+i, this.y); ctx.lineTo(sx+i, this.y+this.h); ctx.stroke();
        }
        ctx.restore();
    }
}

class Hazard {
    constructor(x, y, type) { Object.assign(this, {x, y, type, t: 0}); }
    update(fx) {
        this.t++;
        if(this.type === 'DRONE') this.x += Math.sin(this.t * 0.05) * 5;
        if(this.type === 'CANNON' && this.t % 120 === 0) {
            fx.push(new Proj(this.x, this.y+20, -12));
        }
    }
    draw(ctx, camX) {
        let sx = this.x - camX;
        ctx.save();
        ctx.shadowBlur = 25; ctx.shadowColor = "#ff3f34";
        if(this.type === 'SPIKE') {
            ctx.fillStyle = "#ff3f34"; ctx.beginPath(); ctx.moveTo(sx, this.y+45); ctx.lineTo(sx+25, this.y); ctx.lineTo(sx+50, this.y+45); ctx.fill();
        } else if(this.type === 'DRONE') {
            ctx.fillStyle = "#fff"; ctx.beginPath(); ctx.arc(sx+25, this.y+25, 20, 0, 7); ctx.fill();
            ctx.fillStyle = "#000"; ctx.fillRect(sx+10, this.y+22, 30, 6);
        } else if(this.type === 'LASER') {
            if(Math.floor(this.t/60)%2 === 0) {
                ctx.fillStyle = "rgba(255,0,0,0.8)"; ctx.shadowBlur = 40;
                ctx.fillRect(sx+22, this.y-600, 6, 600);
            }
            ctx.fillStyle = "#333"; ctx.fillRect(sx, this.y, 50, 15);
        }
        ctx.restore();
    }
}

class Particle {
    constructor(x, y, c, mode) {
        this.x = x; this.y = y; this.c = c;
        this.vx = (Math.random()-0.5)*12;
        this.vy = mode === 2 ? -Math.random()*15 : (Math.random()-0.5)*5;
        this.s = 5 + Math.random()*10; this.o = 1.0;
    }
    update() { this.x += this.vx; this.y += this.vy; this.vy += 0.5; this.o -= 0.02; }
    draw(ctx, camX) {
        ctx.globalAlpha = this.o; ctx.fillStyle = this.c;
        ctx.fillRect(this.x - camX, this.y, this.s, this.s);
        ctx.globalAlpha = 1;
    }
}

class Proj {
    constructor(x, y, vx) { this.x = x; this.y = y; this.vx = vx; }
    draw(ctx, camX) {
        ctx.fillStyle = "#ffea00"; ctx.shadowBlur = 20; ctx.shadowColor = "orange";
        ctx.beginPath(); ctx.arc(this.x-camX, this.y, 10, 0, 7); ctx.fill();
    }
}

// --- BOOT SYSTEM ---
const Vanguard = new VanguardEngine();

function bootSystem() {
    document.getElementById('menu').style.opacity = '0';
    setTimeout(() => {
        document.getElementById('menu').style.display = 'none';
        Vanguard.gameState = 'PLAY';
        Vanguard.initLevel(Vanguard.currentLvl);
        if(!loopId) Vanguard.run(performance.now());
    }, 800);
}

setup();
</script>
</body>
</html>
