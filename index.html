<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Aaron Adventures - Vanguard Overdrive</title>
    <style>
        @import url('https://fonts.googleapis.com');
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Orbitron', sans-serif; }
        canvas { display: block; filter: saturate(1.4) contrast(1.2) blur(0.4px); }
        
        #ui { position: absolute; top: 40px; left: 40px; color: #fff; pointer-events: none; z-index: 10; }
        .lvl-text { font-size: 50px; font-weight: 900; letter-spacing: 10px; text-shadow: 0 0 20px #00ff88; }
        
        #menu { position: absolute; inset: 0; background: radial-gradient(circle at center, rgba(10,15,30,0.95) 0%, #000 100%); z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.5s; }
        .skin-grid { display: flex; gap: 20px; margin: 40px 0; perspective: 1000px; }
        .skin-slot { width: 80px; height: 80px; border: 2px solid #333; border-radius: 15px; cursor: pointer; transition: 0.4s; position: relative; background: #111; }
        .skin-slot.unlocked:hover { transform: translateZ(20px); border-color: #00ff88; box-shadow: 0 0 30px #00ff88; }
        .skin-slot.selected { border-color: #00ff88; background: #1a1a1a; box-shadow: 0 0 40px #00ff88; }
        .skin-slot.locked::after { content: 'ðŸ”’'; position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 24px; background: rgba(0,0,0,0.7); border-radius: 13px; }
        
        .start-btn { background: transparent; border: 2px solid #fff; color: #fff; padding: 20px 80px; font-size: 28px; border-radius: 50px; cursor: pointer; transition: 0.3s; letter-spacing: 5px; }
        .start-btn:hover { background: #fff; color: #000; box-shadow: 0 0 50px #fff; }
    </style>
</head>
<body>

<div id="ui">
    <div class="lvl-text">L-V-L <span id="lvlDisplay">1</span></div>
    <div id="biomeLabel" style="letter-spacing: 5px; color: #555;">SECTOR: ALPHA</div>
</div>

<div id="menu">
    <h1 style="color: #fff; font-size: 80px; letter-spacing: 20px; margin: 0;">AARON</h1>
    <p style="color: #00ff88; letter-spacing: 5px;">ADVENTURES - VANGUARD</p>
    <div class="skin-grid" id="skinVault"></div>
    <button class="start-btn" onclick="startSequence()">INITIALIZE</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
/**
 * AARON ADVENTURES - SUPREME ENGINE
 * No-Loop-Bug System + Pro-Graphics Pipeline
 */

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let w, h, camX = 0, currentLvl = 1, skinIdx = 0, loopId = null;
let gameState = 'menu';

const SKINS = [
    { name: "Vanguard", color: "#1a1a2e", eye: "#ff0044", glow: "#ff0044" },
    { name: "Hunter", color: "#0f2010", eye: "#00ff88", glow: "#00ff88" },
    { name: "Wraith", color: "#161616", eye: "#8800ff", glow: "#8800ff" },
    { name: "Ice-9", color: "#e1f5fe", eye: "#0091ea", glow: "#00b0ff" },
    { name: "Prime", color: "#fbc02d", eye: "#ffffff", glow: "#ffffff" }
];

const BIOMES = [
    { name: "VOID", bg: "#020205", p: "#0a0a0a", fog: "#000" },
    { name: "NEON-FOREST", bg: "#050a05", p: "#0a150a", fog: "#0a210f" },
    { name: "CRYO-CHAMBER", bg: "#050a15", p: "#0a101a", fog: "#1e272e" },
    { name: "INFERNO", bg: "#100505", p: "#1a0a0a", fog: "#2c0d0d" }
];

const player = { x: 150, y: 300, w: 48, h: 48, vx: 0, vy: 0, acc: 0.8, friction: 0.85, jump: -18, g: 0.85, grounded: false };
let platforms = [], hazards = [], projectiles = [], particles = [];
const keys = {};

function initApp() {
    w = canvas.width = window.innerWidth;
    h = canvas.height = window.innerHeight;
    renderVault();
}

function buildLevel(lvl) {
    platforms = []; hazards = []; projectiles = []; particles = [];
    camX = 0; player.vx = 0; player.vy = 0; player.x = 150; player.y = 300;

    const bIdx = Math.floor((lvl-1)/10) % BIOMES.length;
    const biome = BIOMES[bIdx];
    document.getElementById('lvlDisplay').innerText = lvl;
    document.getElementById('biomeLabel').innerText = "SECTOR: " + BIOMES[bIdx].name;

    let lx = 0, ly = 550;
    // Startplattform (immer sicher)
    platforms.push({ x: 0, y: 550, w: 500, h: 200, type: 'norm', glow: '#333' });

    // Level-Schwierigkeit skalieren
    const obstacleChance = Math.min(0.8, 0.1 + (lvl * 0.02));

    for(let i=0; i < 15 + Math.floor(lvl/2); i++) {
        let pw = 200 + Math.random() * 150;
        let px = lx + 160 + Math.random() * 100;
        let py = ly + (Math.random() * 160 - 80);
        py = Math.max(200, Math.min(h - 200, py));

        let type = 'norm';
        let pglow = '#222';
        
        // Erst ab hÃ¶heren Leveln komplexere BlÃ¶cke
        const r = Math.random();
        if(lvl > 5 && r > 0.9) { type = 'move'; pglow = '#00d2d3'; }
        else if(lvl > 8 && r > 0.8) { type = 'ice'; pglow = '#74b9ff'; }
        else if(lvl > 12 && r > 0.7) { type = 'crumble'; pglow = '#a29bfe'; }

        platforms.push({ x: px, y: py, w: pw, h: 40, type, oy: py, off: Math.random()*10, glow: pglow, life: 1 });

        // Hindernisse (reguliert)
        if(Math.random() < obstacleChance) {
            let hx = px + 50 + Math.random() * (pw - 100);
            let hType = (lvl < 10) ? 'spike' : (Math.random() > 0.5 ? 'drone' : 'cannon');
            if(lvl > 20 && Math.random() > 0.8) hType = 'laser';
            
            hazards.push({ x: hx, y: py - 40, type: hType, v: 2, t: 0 });
        }

        lx = px; ly = py;
    }
    // Goal
    platforms.push({ x: lx + 400, y: ly - 50, w: 150, h: 500, type: 'goal', glow: '#00ff88' });
}

// --- RENDERING CORE ---

function draw() {
    if(gameState !== 'play') return;
    
    const b = BIOMES[Math.floor((currentLvl-1)/10) % BIOMES.length];
    ctx.fillStyle = b.bg;
    ctx.fillRect(0, 0, w, h);

    // Dynamic Physics
    if(keys['ArrowLeft']) player.vx -= player.acc;
    if(keys['ArrowRight']) player.vx += player.acc;
    player.vx *= player.friction;
    player.vy += player.g;
    player.x += player.vx;
    player.y += player.vy;
    camX += (player.x - camX - w/3) * 0.1;

    // Platform Rendering
    player.grounded = false;
    platforms.forEach(p => {
        if(p.type === 'move') p.y = p.oy + Math.sin(Date.now()/500 + p.off) * 60;
        
        let screenX = p.x - camX;
        ctx.save();
        ctx.shadowBlur = 15; ctx.shadowColor = p.glow;
        ctx.fillStyle = (p.type === 'goal') ? '#00ff88' : '#111';
        ctx.beginPath();
        ctx.roundRect(screenX, p.y, p.w, p.h, 10);
        ctx.fill();
        
        // Glas-Effekt oben
        ctx.fillStyle = "rgba(255,255,255,0.05)";
        ctx.fillRect(screenX, p.y, p.w, 5);
        ctx.restore();

        // Collision
        if(player.x + player.w > p.x && player.x < p.x + p.w && player.y + player.h > p.y && player.y + player.h < p.y + p.h + 20 && player.vy >= 0) {
            if(p.type === 'goal') return winLevel();
            player.y = p.y - player.h; player.vy = 0; player.grounded = true;
            if(p.type === 'crumble') p.life -= 0.01;
        }
    });

    // Hazard Rendering
    hazards.forEach(hz => {
        let hx = hz.x - camX;
        ctx.save();
        if(hz.type === 'spike') {
            ctx.fillStyle = '#ff4757'; ctx.shadowBlur = 10; ctx.shadowColor = 'red';
            ctx.beginPath(); ctx.moveTo(hx, hz.y+40); ctx.lineTo(hx+20, hz.y); ctx.lineTo(hx+40, hz.y+40); ctx.fill();
        } else if(hz.type === 'drone') {
            hz.x += Math.sin(Date.now()/1000) * 2;
            ctx.fillStyle = '#fff'; ctx.shadowBlur = 15; ctx.shadowColor = '#00d2d3';
            ctx.beginPath(); ctx.arc(hx+20, hz.y+20, 15, 0, 7); ctx.fill();
        } else if(hz.type === 'cannon') {
            ctx.fillStyle = '#555'; ctx.fillRect(hx, hz.y, 40, 40);
            if(Date.now() % 1500 < 20) projectiles.push({x: hz.x, y: hz.y+20, vx: -8});
        }
        ctx.restore();
        if(Math.hypot(player.x+24 - (hz.x+20), player.y+24 - (hz.y+20)) < 35) die();
    });

    // Projectiles
    ctx.fillStyle = '#ff9f43';
    projectiles.forEach((pr, i) => {
        pr.x += pr.vx;
        ctx.beginPath(); ctx.arc(pr.x-camX, pr.y, 8, 0, 7); ctx.fill();
        if(Math.hypot(player.x+24 - pr.x, player.y+24 - pr.y) < 25) die();
    });

    // Aaron Rendering (Supreme Detail)
    const s = SKINS[skinIdx];
    ctx.save();
    ctx.translate(player.x - camX + 24, player.y + 24);
    ctx.rotate(player.vx * 0.03);
    
    // Outer Glow
    ctx.shadowBlur = 30; ctx.shadowColor = s.glow;
    
    // Head Design
    ctx.fillStyle = s.color;
    ctx.beginPath(); ctx.roundRect(-24, -24, 48, 48, 14); ctx.fill();
    ctx.strokeStyle = "rgba(255,255,255,0.2)"; ctx.stroke();
    
    // High-Tech Visor
    ctx.shadowBlur = 0;
    ctx.fillStyle = "rgba(0,0,0,0.5)";
    ctx.fillRect(-24, -10, 48, 15);
    
    // Glowing Eyes
    ctx.fillStyle = s.eye;
    ctx.shadowBlur = 10; ctx.shadowColor = s.eye;
    ctx.fillRect(-16, -6, 12, 5); ctx.fillRect(4, -6, 12, 5);
    
    // Veteran Mark
    ctx.strokeStyle = "rgba(255,0,0,0.6)"; ctx.lineWidth = 2;
    ctx.beginPath(); ctx.moveTo(10, -20); ctx.lineTo(16, 0); ctx.stroke();
    ctx.restore();

    if(player.y > h + 200) die();
    
    loopId = requestAnimationFrame(draw);
}

// --- SYSTEM LOGIC ---

function die() {
    buildLevel(currentLvl);
}

function winLevel() {
    cancelAnimationFrame(loopId); // Stop den Loop sofort
    gameState = 'menu';
    currentLvl++;
    document.getElementById('menu').style.display = 'flex';
    document.getElementById('menu').style.opacity = '1';
    renderVault();
}

function renderVault() {
    const v = document.getElementById('skinVault');
    v.innerHTML = '';
    const unlocked = Math.floor((currentLvl-1)/5) + 1;
    SKINS.forEach((s, i) => {
        const slot = document.createElement('div');
        slot.className = `skin-slot ${i < unlocked ? 'unlocked' : 'locked'} ${i === skinIdx ? 'selected' : ''}`;
        slot.style.background = s.color;
        if(i < unlocked) slot.onclick = () => { skinIdx = i; renderVault(); };
        v.appendChild(slot);
    });
}

function startSequence() {
    document.getElementById('menu').style.opacity = '0';
    setTimeout(() => {
        document.getElementById('menu').style.display = 'none';
        gameState = 'play';
        buildLevel(currentLvl);
        cancelAnimationFrame(loopId); // Sicherstellen, dass kein alter Loop lÃ¤uft
        draw();
    }, 500);
}

window.onkeydown = (e) => {
    keys[e.code] = true;
    if((e.code === 'ArrowUp' || e.code === 'Space') && player.grounded) player.vy = player.jump;
};
window.onkeyup = (e) => keys[e.code] = false;

initApp();
</script>
</body>
</html>
